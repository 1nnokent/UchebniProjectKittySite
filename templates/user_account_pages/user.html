<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Кошьки inc.</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="{{ url_for('static', filename='/img/favicon.png') }}" rel="icon">
  <link href="{{ url_for('static', filename='/img/apple-touch-icon.png') }}" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{{ url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='vendor/bootstrap-icons/bootstrap-icons.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='vendor/aos/aos.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='vendor/glightbox/css/glightbox.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='vendor/swiper/swiper-bundle.min.css') }}" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="{{ url_for('static', filename='/css/main.css') }}" rel="stylesheet">

  <style>
    body {
      background-color: #f8f9fa; /* Цвет фона для страницы */
      overflow-y: scroll;
    }

    .profile-container {
      display: flex;
      flex-direction: column; /* Вертикальное расположение */
      align-items: center; /* Центрирование по горизонтали */
      justify-content: center; /* Центрирование по вертикали */
      max-width: 600px; /* Максимальная ширина контейнера */
      margin: 10% auto 0; /* Центрирование контейнера и отступ сверху */
      padding: 20px; /* Отступ внутри контейнера */
      background-color: #e9ecef; /* Цвет фона для контейнера */
      border-radius: 10px; /* Скругленные углы */
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Тень для контейнера */
    }

    .statistics-container {
      display: flex;
      flex-direction: column; /* Вертикальное расположение */
      align-items: center; /* Центрирование по горизонтали */
      justify-content: center; /* Центрирование по вертикали */
      max-width: 1200px; /* Максимальная ширина контейнера */
      margin: 10% auto 0; /* Центрирование контейнера и отступ сверху */
      padding: 20px; /* Отступ внутри контейнера */
      background-color: #e9ecef; /* Цвет фона для контейнера */
      border-radius: 10px; /* Скругленные углы */
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Тень для контейнера */
    }

    img {
      max-width: 300px; /* Ограничение ширины изображения */
      height: auto; /* Автоматическая настройка высоты */
      border-radius: 50%; /* Круглая форма для фото */
      margin-bottom: 20px; /* Отступ снизу */
    }

    .info-list {
      margin-top: 20px; /* Отступ сверху */
      list-style-type: none; /* Убираем маркеры списка */
      padding: 0; /* Убираем отступы у списка */
      text-align: center; /* Центрируем текст списка */
    }

    .info-list li {
      margin: 5px 0; /* Отступы для элементов списка */
    }

    .about-section {
      text-align: center; /* Центрируем текст */
      margin-top: 20px; /* Отступ сверху */
    }

    .col-green {
        background-color: #4CAF50; /* ярко-зеленый */
    }

    .col-light-green {
        background-color: #8BC34A; /* светло-зеленый */
    }

    .col-yellow {
        background-color: #FFEB3B; /* желтый */
    }

    .col-red {
        background-color: #F44336; /* красный */
    }
  </style>
</head>

<body>
  {% include 'header.html' %}

  <div class="profile-container">
    <img src="{{ url_for('static', filename=photo_directory) }}" alt="Фото пользователя">
    <ul class="info-list">
      <li><h3>{{ first_name }} {{ second_name }}</h3></li>
      <li><h4>{{ email }}</h4></li>
      <li><h4>{{ birth_date }}</h4></li>
      <li><h5>С нами с: {{ registration_time }}</h5></li>
      <li><h5>Школа: {{ school_id }}</h5></li>
      <li><h5>Город: {{ city_id }}</h5></li>
      <li><h5>Класс: {{ class }}</h5></li>
    </ul>
  </div>


  <div class="statistics-container">
    <h2 style="text-transform: uppercase;">Статистика</h2>
    <table class="table table-bordered" style="margin-top: 10px;">
        <thead>
            <tr>
                <th>№ Задания</th>
                {% for task in range(1, 27) %}
                <th>{{ task }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Количество попыток</td>
                {% for attempt in number_of_attempts %}
                    <td>{{ number_of_attempts[attempt] }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Успешные попытки</td>
                {% for right_attempt in number_of_right_attempts %}
                    <td>{{ number_of_right_attempts[right_attempt] }}</td>
                {% endfor %}
            </tr>
        </tbody>
    </table>
  </div>

  <!-- JS Files -->
  <script src="static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script>
    console.log("Скрипт запущен.");
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Скрипт запущен2.");
        const attempts = {{ number_of_attempts|tojson }}; // Словарь с количеством попыток
        const rightAttempts = {{ number_of_right_attempts|tojson }}; // Словарь с успешными попытками
        const columns = document.querySelectorAll('.table tbody tr'); // Получаем все строки таблицы

        // Предположим, что у нас есть некий способ определения количества столбцов
        const numberOfColumns = Object.keys(attempts).length; // Количество столбцов, равное количеству ключей в словаре

        for (let colIndex = 1; colIndex <= numberOfColumns; colIndex++) {
            const totalAttempts = attempts[colIndex] || 0; // Получаем общее количество попыток
            const successfulAttempts = rightAttempts[colIndex] || 0; // Получаем количество успешных попыток

            if (totalAttempts > 0) {
                const successRate = (successfulAttempts / totalAttempts) * 100;
                let columnClass;

                if (successRate >= 85) {
                    columnClass = 'col-green';
                } else if (successRate >= 75) {
                    columnClass = 'col-light-green';
                } else if (successRate >= 65) {
                    columnClass = 'col-yellow';
                } else {
                    columnClass = 'col-red';
                }

                // Применяем класс к каждой ячейке в столбце
                columns.forEach(row => {
                    const cell = row.cells[colIndex]; // Получаем ячейку по индексу столбца
                    if (cell) {
                        cell.classList.add(columnClass); // Добавляем соответствующий класс
                    }
                });
            }
        }
    });
  </script>
</body>

</html>